<!DOCTYPE html>
<html lang="en">
<head>
        <title>Many craft. Wow. Such create : Running sshd on 443/tcp</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="../../../../theme/css/main.css" type="text/css" />
        <link href="../../../../" type="application/atom+xml" rel="alternate" title="Many craft. Wow. Such create ATOM Feed" />
        <link href="../../../../feeds/rss.xml" type="application/atom+xml" rel="alternate" title="Many craft. Wow. Such create RSS Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../../../../css/ie.css"/>
                <script src="../../../../js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../../../../css/ie6.css"/><![endif]-->

</head>

<body>
	<div id="wrap" style="width:850px">
	    <div id="container" style="width:560px">


            <div class="entry">
        
<header>
<h1><a href="../../../.." id="site-title">  </a>         <a href="../../../../2015/Nov/17/running-sshd-on-443tcp/" id="page-title">Running sshd on 443/tcp</a></h1>
<time datetime="2015-11-17T00:00:00+01:00">Tue 17 November 2015</time></header>
<article>
    <p><center><img alt="Selinux" src="../../../../images/selinux-logo.png" /></center></p>
<h3>What?</h3>
<p>So I had this need to run <strong>ssh</strong> daemon on port 443/TCP. I reconfigured sshd daemon, iptables and stucked with Selinux
policy, when I wanted to assign port 443 to sshd_port_t (so I thought I'd need to remove in the first step actual 
assignment of port 443 which is http_port_t):</p>
<div class="highlight"><pre><span></span><span class="o">[</span>root@srv ~<span class="o">]</span><span class="c1"># semanage port -d -t http_port_t -p tcp 443                                                                                                          </span>
ValueError: Port tcp/443 is defined in policy, cannot be deleted
</pre></div>


<h3>SSH on port 443? sshd configuration + iptables</h3>
<p>Yup, it happens ;)</p>
<p>It's simple reconfiguration done in <strong>/etc/ssh/sshd_config</strong>:</p>
<div class="highlight"><pre><span></span>Port 22
Port 443
</pre></div>


<p>So as you can see I left sshd running also on port 22/tcp. Also reconfigured iptables (Centos 7, no firewalld yet):</p>
<div class="highlight"><pre><span></span><span class="o">[</span>root@srv ~<span class="o">]</span><span class="c1"># grep 443 /etc/sysconfig/iptables</span>
-A INPUT -p tcp -m state --state NEW -m tcp --dport <span class="m">443</span> -j ACCEPT
</pre></div>


<h3>Back to Selinux - how to fix this?</h3>
<p>Actually answer lays in documentation:</p>
<div class="highlight"><pre><span></span>$ man semanage-port

       -m, --modify
              Modify a record of the specified object <span class="nb">type</span>
</pre></div>


<p>So basically instead of removing this httpd_port_t assignment, what is impossible without recompiling the policy I just
modified it:</p>
<div class="highlight"><pre><span></span><span class="o">[</span>root@srv ~<span class="o">]</span><span class="c1"># semanage port -m -t ssh_port_t -p tcp 443</span>
</pre></div>


<p>And now we have:</p>
<div class="highlight"><pre><span></span><span class="o">[</span>root@netrunner ~<span class="o">]</span><span class="c1"># semanage port -l | grep 443                                                                                                                         </span>
http_port_t                    tcp      80, 81, 443, 488, 8008, 8009, 8443, 9000
ssh_port_t                     tcp      443, 444, 22
</pre></div>


<p>Works for me ;)</p>
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
       var disqus_shortname = 'manycraft';
       var disqus_identifier = '2015/Nov/17/running-sshd-on-443tcp/';
       var disqus_url = '../../../../2015/Nov/17/running-sshd-on-443tcp/';
       (function() {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] ||
             document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the comments.</noscript>
</article>
            </div>
        </div>

        <div id="sidebar">
            <h1><a href="http://maciej.lasyk.info" title="title">Many craft. Wow. Such create</a><br><img
                src="/theme/img/chunkybacon.png"></h1>
            <span class="description"> </span>
        </div>

        <div id="feedsbar">
            <ul>
            <li><a href="/feeds/rss.xml">RSS</a> | <a href="/feeds/atom.xml">Atom</a></li>
            </ul>
        </div>

        <div id="tagcloud">
        <nav>
            <ul class="tagcloud">
            </ul>
        </nav>
        </div>

        <div id="footer">
            <div id="credits">
                <span>Adapted from <a
                        href="http://wordpress.org/themes/monospace">Monospace</a>
                || Created with <a href="">Pelican</a> || Hosted with <a
                    href="http://docker.io/">Docker</a></span>
                <p>content copyrights &copy; Maciej Lasyk</p>
            </div>
                
        </div>

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-61452-19");
    pageTracker._trackPageview();
    } catch(err) {}</script>
<script type="text/javascript">
    var disqus_shortname = 'manycraft';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

    </div>

</body>
</html>