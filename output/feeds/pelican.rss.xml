<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Many craft. Wow. Such create</title><link>http://maciej.lasyk.info/</link><description></description><atom:link href="http://maciej.lasyk.info/feeds/pelican.rss.xml" rel="self"></atom:link><lastBuildDate>Tue, 19 Aug 2014 00:35:00 +0200</lastBuildDate><item><title>Automating Pelican with Git</title><link>http://maciej.lasyk.info/2014/Aug/19/automating-pelican-with-git/</link><description>&lt;p&gt;&lt;center&gt;&lt;img alt="Pelican Automation with Git" src="http://maciej.lasyk.info/images/pelican-automation.png" /&gt;&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;This is a first blogpost of a whole series about working with
&lt;a href="http://docs.getpelican.com/"&gt;Pelican&lt;/a&gt;. I'll be publishing all future post with
the hashtag &lt;a href="tag/pelican.html"&gt;#pelican&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;What kind of automation?&lt;/h3&gt;
&lt;p&gt;My first step with migrating my &lt;a href="http://maciek.lasyk.info/sysop"&gt;old blog&lt;/a&gt; to
this &lt;strong&gt;Pelican - based&lt;/strong&gt; was to automate the whole process of deploying new
posts. I just want to work with &lt;strong&gt;Markdown&lt;/strong&gt; files on my laptop and push those
to the git repository. And let the rest magically happen in the background.&lt;/p&gt;
&lt;h3&gt;Architecture&lt;/h3&gt;
&lt;p&gt;Basically I write posts on my laptop, then I push changes to the remote bare
git repo, this repo has &lt;strong&gt;post-update&lt;/strong&gt; hook which communicates with my
webserver and tells him to pull all the changes:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;laptop with markdowns ----&lt;span class="o"&gt;(&lt;/span&gt;git push&lt;span class="o"&gt;)&lt;/span&gt;----&amp;gt; remote git bare repo 
----&lt;span class="o"&gt;(&lt;/span&gt;post-update hook----&amp;gt; webserver
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Abracadabra&lt;/h3&gt;
&lt;p&gt;What's important here - I've added to the repo my whole &lt;strong&gt;pelican&lt;/strong&gt;
directory. This is because I'm realy lazy and just wanted to keep all the 
changes and use this repo also for backup purposes. Of course you'll want to
play with &lt;strong&gt;.gitignore&lt;/strong&gt; file and ommit couple of dirs and files :)&lt;/p&gt;
&lt;p&gt;On the server with git bare repo I've created &lt;strong&gt;hooks/post-update&lt;/strong&gt; file
(perms 0700) with following contents:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="c"&gt;# just invoke the update script on the webserver:&lt;/span&gt;
ssh home-docker &lt;span class="s1"&gt;&amp;#39;/home/docent/scripts/update_maciej.lasyk.info.sh&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;As you can see I'm using here &lt;strong&gt;ssh home-docker&lt;/strong&gt; command. This is an alias
that exists in my &lt;strong&gt;~/.ssh/config&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;Host home-docker
Hostname vm-9-containers.netrunner.lasyk.info
User docent
Port 22
ProxyCommand ssh -p 55555 docent@netrunner.lasyk.info nc %h %p 2&amp;gt; /dev/null
IdentityFile ~/.ssh/id_rsa
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This basically connects to VM hosting Docker containers through the bastion
server (no direct SSH allowed to containers VM from outside or DMZ).&lt;/p&gt;
&lt;p&gt;So now anytime I post something and commit it to the repo above script will be
invoked via SSH. And this calls another script - this time on webserver:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;#!/bin/bash&lt;/span&gt;
&lt;span class="nv"&gt;GIT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/usr/bin/git

&lt;span class="nb"&gt;cd&lt;/span&gt; /srv/docker_mounts/nginx/public_html/maciej.lasyk.info/
&lt;span class="nv"&gt;$GIT&lt;/span&gt; fetch --all
&lt;span class="nv"&gt;$GIT&lt;/span&gt; reset --hard docent/master
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Above script fetches all data from the remote repository and then sets the
last commit as the HEAD. No webserver restart is needed here as those are only
static files :)&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Maciej Lasyk</dc:creator><pubDate>Tue, 19 Aug 2014 00:35:00 +0200</pubDate><guid>tag:maciej.lasyk.info,2014-08-19:2014/Aug/19/automating-pelican-with-git/</guid><category>pelican</category><category>git</category></item><item><title>Moving to Pelican</title><link>http://maciej.lasyk.info/2014/Aug/08/moving-to-pelican/</link><description>&lt;p&gt;So it finally happened. After 6 months I started migrating my blog from crapy
Wordpress to &lt;a href="https://github.com/getpelican/pelican/"&gt;Pelican&lt;/a&gt;. There're still plenty of things I have to take care of:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;git automation (pull / push)&lt;/li&gt;
&lt;li&gt;some commenting functionality&lt;/li&gt;
&lt;li&gt;layout polishing (current layout is based on &lt;a href="https://github.com/getpelican/pelican-themes/tree/master/monospace"&gt;monospace&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;slug (call it: modrewrite / url fixing)&lt;/li&gt;
&lt;li&gt;images upload handling (I want all images I use in post content to be uploaded and reformatted automatically&lt;/li&gt;
&lt;li&gt;code syntax highlightning&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/getpelican/pelican-plugins"&gt;plugins&lt;/a&gt; review&lt;/li&gt;
&lt;li&gt;RSS handling&lt;/li&gt;
&lt;li&gt;tag cloud (I'll use only that instead of categories)&lt;/li&gt;
&lt;li&gt;maybe some spell - check? or rather will stick to VIM - based&lt;/li&gt;
&lt;li&gt;migrating posts from my old Wordpress - blog&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Looks like a plate is full. ETA? Will be delivered somehow between Monday and
end of the next year ;)&lt;/p&gt;
&lt;p&gt;What's beautiful here? It's 100% Markdown &amp;lt;- Pelican &amp;lt;- Nginx &amp;lt;- Docker &amp;lt;-
Fedora &amp;lt;- my home server :)&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Maciej Lasyk</dc:creator><pubDate>Fri, 08 Aug 2014 00:21:00 +0200</pubDate><guid>tag:maciej.lasyk.info,2014-08-08:2014/Aug/08/moving-to-pelican/</guid><category>pelican</category></item></channel></rss>